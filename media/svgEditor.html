<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SVG Editor with Save + Apply</title>
<style>
  textarea { width: 100%; height: 300px; font-family: monospace; }
  svg { border: 1px solid #ccc; width: 512px; height: 512px; display: block; margin-top: 10px; }
</style>
</head>
<body>

<h2>Editor de SVG</h2>

<textarea id="editor" name="svgCode"></textarea>

<button type="button" id="applyBtn">ðŸ”„ Apply Changes</button>
<form id="editorForm" method="post" action="save_svg.php" style="display: inline;">
  <input type="hidden" name="svgCode" id="hiddenSvgCode">
  <input type="hidden" name="valor" id="valor">
  <button type="submit">ðŸ’¾ Save edited SVG</button>
</form>

<svg id="target"></svg>

<script>
  const target = document.getElementById("target");
  const editor = document.getElementById("editor");
  const applyBtn = document.getElementById("applyBtn");
  const hiddenSvgCode = document.getElementById("hiddenSvgCode");

  // Get the "valor" parameter from the URL
  const params = new URLSearchParams(window.location.search);
  const valor = params.get("valor");

  if (valor) {
    const filePath = `${valor}.svg`;

    document.getElementById("valor").value = valor;

    fetch(filePath)
      .then(response => {
        if (!response.ok) throw new Error("SVG not found");
        return response.text();
      })
      .then(svgText => {
        document.getElementById("target").innerHTML = svgText;
      })
      .catch(err => {
        document.getElementById("target").textContent = "âš ï¸ Error loading SVG: " + err.message;
      });
  } else {
    document.getElementById("target").textContent = "âš ï¸ No 'valor' parameter found in URL.";
  }

    
  // Load 0.svg into textarea on startup
  fetch(`${valor}.svg`)
    .then(res => res.text())
    .then(svgText => {
      editor.value = svgText;
      renderToTarget(svgText);
    })
    .catch(err => editor.value = `<!-- Falla al cargar svg: ${err} -->`);

  // Render function
  function renderToTarget(code) {
    target.innerHTML = "";
    const parser = new DOMParser();
    const doc = parser.parseFromString(code, "image/svg+xml");
    const svgEl = doc.documentElement;
    if (!svgEl) return;
    // Copy attributes
    for (const attr of svgEl.attributes) target.setAttribute(attr.name, attr.value);
    // Copy children
    while (svgEl.firstChild) target.appendChild(svgEl.firstChild);
  }

  // Apply button updates preview
  applyBtn.addEventListener("click", () => {
    renderToTarget(editor.value);
  });

  // Before form submit â†’ copy textarea value into hidden field
  document.getElementById("editorForm").addEventListener("submit", () => {
    hiddenSvgCode.value = editor.value;
  });

</script>
</body>
</html>
